<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>5 Lab: Cross-Validation and the Bootstrap | Data Visualization</title>
  <meta name="description" content="This manual supports the Data visualization course from the Department of Statistics at Northwestern University.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="5 Lab: Cross-Validation and the Bootstrap | Data Visualization" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This manual supports the Data visualization course from the Department of Statistics at Northwestern University." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Lab: Cross-Validation and the Bootstrap | Data Visualization" />
  
  <meta name="twitter:description" content="This manual supports the Data visualization course from the Department of Statistics at Northwestern University." />
  



<meta name="date" content="2019-01-01">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="lab-logistic-regression-lda-qda-and-knn.html">
<link rel="next" href="glossary-of-terms.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Visualization Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html"><i class="fa fa-check"></i><b>1</b> Project Workflow and Style Guide</a><ul>
<li class="chapter" data-level="1.1" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#directory-setup"><i class="fa fa-check"></i><b>1.1</b> Directory Setup</a></li>
<li class="chapter" data-level="1.2" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#files"><i class="fa fa-check"></i><b>1.2</b> Files</a><ul>
<li class="chapter" data-level="1.2.1" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#r-scripts"><i class="fa fa-check"></i><b>1.2.1</b> R scripts</a></li>
<li class="chapter" data-level="1.2.2" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#rmarkdown"><i class="fa fa-check"></i><b>1.2.2</b> Rmarkdown</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#code-guidelines"><i class="fa fa-check"></i><b>1.3</b> Code Guidelines</a><ul>
<li class="chapter" data-level="1.3.1" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#comments"><i class="fa fa-check"></i><b>1.3.1</b> Comments</a></li>
<li class="chapter" data-level="1.3.2" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#packages"><i class="fa fa-check"></i><b>1.3.2</b> Packages</a></li>
<li class="chapter" data-level="1.3.3" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#tidyverse"><i class="fa fa-check"></i><b>1.3.3</b> Tidyverse</a></li>
<li class="chapter" data-level="1.3.4" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#naming-objects"><i class="fa fa-check"></i><b>1.3.4</b> Naming Objects</a></li>
<li class="chapter" data-level="1.3.5" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#spacing-and-indentation"><i class="fa fa-check"></i><b>1.3.5</b> Spacing and Indentation</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#output"><i class="fa fa-check"></i><b>1.4</b> Output</a><ul>
<li class="chapter" data-level="1.4.1" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#graphics"><i class="fa fa-check"></i><b>1.4.1</b> Graphics</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#citingdocumenting-data"><i class="fa fa-check"></i><b>1.5</b> Citing/Documenting Data</a><ul>
<li class="chapter" data-level="1.5.1" data-path="project-workflow-and-style-guide.html"><a href="project-workflow-and-style-guide.html#sample-citation"><i class="fa fa-check"></i><b>1.5.1</b> Sample Citation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="stat-301-2-final-project.html"><a href="stat-301-2-final-project.html"><i class="fa fa-check"></i><b>2</b> STAT 301-2 Final Project</a><ul>
<li class="chapter" data-level="2.1" data-path="stat-301-2-final-project.html"><a href="stat-301-2-final-project.html#milestones"><i class="fa fa-check"></i><b>2.1</b> Milestones</a></li>
<li class="chapter" data-level="2.2" data-path="stat-301-2-final-project.html"><a href="stat-301-2-final-project.html#submission"><i class="fa fa-check"></i><b>2.2</b> Submission</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lab-linear-regression.html"><a href="lab-linear-regression.html"><i class="fa fa-check"></i><b>3</b> Lab: Linear Regression</a><ul>
<li class="chapter" data-level="3.1" data-path="lab-linear-regression.html"><a href="lab-linear-regression.html#libraries"><i class="fa fa-check"></i><b>3.1</b> Libraries</a></li>
<li class="chapter" data-level="3.2" data-path="lab-linear-regression.html"><a href="lab-linear-regression.html#simple-linear-regression"><i class="fa fa-check"></i><b>3.2</b> Simple Linear Regression</a><ul>
<li class="chapter" data-level="3.2.1" data-path="lab-linear-regression.html"><a href="lab-linear-regression.html#plots-for-assessing-linear-models"><i class="fa fa-check"></i><b>3.2.1</b> Plots for Assessing Linear Models</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="lab-linear-regression.html"><a href="lab-linear-regression.html#fitting-many-models"><i class="fa fa-check"></i><b>3.3</b> Fitting Many Models</a><ul>
<li class="chapter" data-level="3.3.1" data-path="lab-linear-regression.html"><a href="lab-linear-regression.html#assessing-many-models"><i class="fa fa-check"></i><b>3.3.1</b> Assessing Many Models</a></li>
<li class="chapter" data-level="3.3.2" data-path="lab-linear-regression.html"><a href="lab-linear-regression.html#examing-one-or-fewer-models"><i class="fa fa-check"></i><b>3.3.2</b> Examing One or Fewer Models</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="lab-linear-regression.html"><a href="lab-linear-regression.html#qualitative-predictors"><i class="fa fa-check"></i><b>3.4</b> Qualitative Predictors</a></li>
<li class="chapter" data-level="3.5" data-path="lab-linear-regression.html"><a href="lab-linear-regression.html#modified-workflow"><i class="fa fa-check"></i><b>3.5</b> Modified Workflow</a><ul>
<li class="chapter" data-level="3.5.1" data-path="lab-linear-regression.html"><a href="lab-linear-regression.html#exercise-15-section-3.7---pg-126"><i class="fa fa-check"></i><b>3.5.1</b> Exercise 15 (Section 3.7 - pg 126)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lab-logistic-regression-lda-qda-and-knn.html"><a href="lab-logistic-regression-lda-qda-and-knn.html"><i class="fa fa-check"></i><b>4</b> Lab: Logistic Regression, LDA, QDA, and KNN</a><ul>
<li class="chapter" data-level="4.1" data-path="lab-logistic-regression-lda-qda-and-knn.html"><a href="lab-logistic-regression-lda-qda-and-knn.html#data-setup"><i class="fa fa-check"></i><b>4.1</b> Data Setup</a></li>
<li class="chapter" data-level="4.2" data-path="lab-logistic-regression-lda-qda-and-knn.html"><a href="lab-logistic-regression-lda-qda-and-knn.html#logistic-regression"><i class="fa fa-check"></i><b>4.2</b> Logistic Regression</a></li>
<li class="chapter" data-level="4.3" data-path="lab-logistic-regression-lda-qda-and-knn.html"><a href="lab-logistic-regression-lda-qda-and-knn.html#linear-discriminant-analysis"><i class="fa fa-check"></i><b>4.3</b> Linear Discriminant Analysis</a></li>
<li class="chapter" data-level="4.4" data-path="lab-logistic-regression-lda-qda-and-knn.html"><a href="lab-logistic-regression-lda-qda-and-knn.html#quadratic-discriminant-analysis"><i class="fa fa-check"></i><b>4.4</b> Quadratic Discriminant Analysis</a></li>
<li class="chapter" data-level="4.5" data-path="lab-logistic-regression-lda-qda-and-knn.html"><a href="lab-logistic-regression-lda-qda-and-knn.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>4.5</b> K-Nearest Neighbors</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lab-cross-validation-and-the-bootstrap.html"><a href="lab-cross-validation-and-the-bootstrap.html"><i class="fa fa-check"></i><b>5</b> Lab: Cross-Validation and the Bootstrap</a><ul>
<li class="chapter" data-level="5.1" data-path="lab-cross-validation-and-the-bootstrap.html"><a href="lab-cross-validation-and-the-bootstrap.html#validation-set-approach"><i class="fa fa-check"></i><b>5.1</b> Validation Set Approach</a></li>
<li class="chapter" data-level="5.2" data-path="lab-cross-validation-and-the-bootstrap.html"><a href="lab-cross-validation-and-the-bootstrap.html#leave-one-out-cross-validation"><i class="fa fa-check"></i><b>5.2</b> Leave-One-Out-Cross Validation</a></li>
<li class="chapter" data-level="5.3" data-path="lab-cross-validation-and-the-bootstrap.html"><a href="lab-cross-validation-and-the-bootstrap.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>5.3</b> <span class="math inline">\(k\)</span>-fold Cross-Validation</a></li>
<li class="chapter" data-level="5.4" data-path="lab-cross-validation-and-the-bootstrap.html"><a href="lab-cross-validation-and-the-bootstrap.html#the-bootstrap"><i class="fa fa-check"></i><b>5.4</b> The Bootstrap</a><ul>
<li class="chapter" data-level="5.4.1" data-path="lab-cross-validation-and-the-bootstrap.html"><a href="lab-cross-validation-and-the-bootstrap.html#estimating-the-accuracy-of-a-statistic-of-interest"><i class="fa fa-check"></i><b>5.4.1</b> Estimating the Accuracy of a Statistic of Interest</a></li>
<li class="chapter" data-level="5.4.2" data-path="lab-cross-validation-and-the-bootstrap.html"><a href="lab-cross-validation-and-the-bootstrap.html#estimating-the-accuracy-of-a-linear-regression-model"><i class="fa fa-check"></i><b>5.4.2</b> Estimating the Accuracy of a Linear Regression Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="glossary-of-terms.html"><a href="glossary-of-terms.html"><i class="fa fa-check"></i><b>6</b> Glossary of Terms</a></li>
<li class="chapter" data-level="7" data-path="helpful-references.html"><a href="helpful-references.html"><i class="fa fa-check"></i><b>7</b> Helpful References</a></li>
<li class="divider"></li>
<li><a href="https://www.library.northwestern.edu/research/scholarly/digital-publishing.html" target="blank">Published by Northwestern University Libraries</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Visualization</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lab-cross-validation-and-the-bootstrap" class="section level1">
<h1><span class="header-section-number">5</span> Lab: Cross-Validation and the Bootstrap</h1>
<p>This is a modified version of the <strong>Lab: Cross-Validation and the Bootstrap</strong> section of chapter 5 from <em>Introduction to Statistical Learning with Application in R</em>. This version uses tidyverse techniques and methods that will allow for scalability and a more efficient data analytic pipeline.</p>
<p>We will need the packages loaded below.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load packages</span>
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(modelr)
<span class="kw">library</span>(janitor)
<span class="kw">library</span>(skimr)</code></pre>
<p>Whenever performing analyses or processes that include randomization or resampling it is considered best practice to set the seed of your software’s random number generator. This is done in R using <code>set.seed()</code>. This ensure the analyses and procedures being performed are reproducible. For instance, readers following along in the lab will be able to produce the precisely the same results as those produced in the lab. Provided they run all code in the lab in sequence from start to finish — cannot run code chucks out of order. Setting the seed should occur towards the top of an analytic script, say directly after loading necessary packages.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set seed </span>
<span class="kw">set.seed</span>(<span class="dv">27182</span>) <span class="co"># Used digits from e</span></code></pre>
<div id="validation-set-approach" class="section level2">
<h2><span class="header-section-number">5.1</span> Validation Set Approach</h2>
<p>We explore the use of the validation set approach in order to estimate the test error rates that result from fitting various linear models on the <code>Auto</code> dataset. This dataset is from the <code>ISLR</code> library. Take a moment and inspect the codebook — <code>?ISLR::Auto</code>. We will read in the data from the <code>Auto.csv</code> file and process do a little processing.</p>
<pre class="sourceCode r"><code class="sourceCode r">auto_dat &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/Auto.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">clean_names</span>()</code></pre>
<p>We begin by using the sample() function to split the set of observations sample()
into two halves, by selecting a random subset of 196 observations out of the original 392 observations. We refer to these observations as the training set.</p>
<pre class="sourceCode r"><code class="sourceCode r">auto_validation &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">train =</span> auto_dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">196</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">list</span>(),
                          <span class="dt">test  =</span> auto_dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">setdiff</span>(train) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">list</span>())</code></pre>
<p>Let’s keep it relatively simple and fit a simple linear regression using <code>horsepower</code> to predict <code>mpg</code> and polynomial regressions of up to degree 5 of <code>horsepower</code> to predict <code>mpg</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Setup tibble with model names and formulas</span>
model_def &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">degree =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,
                    <span class="dt">fmla =</span> <span class="kw">str_c</span>(<span class="st">&quot;mpg ~ poly(horsepower, &quot;</span>, degree, <span class="st">&quot;)&quot;</span>))

<span class="co"># Combine validation setup with model fitting info</span>
auto_validation &lt;-<span class="st"> </span>auto_validation <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">crossing</span>(model_def)

<span class="co"># Add model fits and assessment</span>
auto_validation &lt;-<span class="st"> </span>auto_validation <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model_fit =</span> <span class="kw">map2</span>(fmla, train, lm),
         <span class="dt">test_mse =</span> <span class="kw">map2_dbl</span>(model_fit, test, mse))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">auto_validation <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(degree, test_mse) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="co">#  arrange(test_mse) %&gt;% </span>
<span class="st">  </span><span class="kw">kable</span>()</code></pre>
<table>
<thead>
<tr class="header">
<th align="center">degree</th>
<th align="center">test_mse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">26.04603</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">19.98592</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">19.98956</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">20.21181</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">20.46329</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">20.91796</td>
</tr>
<tr class="odd">
<td align="center">7</td>
<td align="center">20.76588</td>
</tr>
<tr class="even">
<td align="center">8</td>
<td align="center">20.78421</td>
</tr>
<tr class="odd">
<td align="center">9</td>
<td align="center">20.89817</td>
</tr>
<tr class="even">
<td align="center">10</td>
<td align="center">20.81535</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r">auto_validation <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(degree, test_mse) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> degree, <span class="dt">y =</span> test_mse)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>()</code></pre>
<p><img src="kuyper-stat302_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
</div>
<div id="leave-one-out-cross-validation" class="section level2">
<h2><span class="header-section-number">5.2</span> Leave-One-Out-Cross Validation</h2>
<pre class="sourceCode r"><code class="sourceCode r">auto_loocv &lt;-<span class="st"> </span>auto_dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">crossv_kfold</span>(<span class="kw">nrow</span>(auto_dat), <span class="dt">id =</span> <span class="st">&quot;fold&quot;</span>)

auto_loocv &lt;-<span class="st"> </span>auto_loocv <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">crossing</span>(model_def) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model_fit =</span> <span class="kw">map2</span>(fmla, train, lm),
         <span class="dt">fold_mse =</span> <span class="kw">map2_dbl</span>(model_fit, test, mse))

auto_loocv <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(degree) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">test_mse =</span> <span class="kw">mean</span>(fold_mse))</code></pre>
<pre><code>## # A tibble: 10 x 2
##    degree test_mse
##     &lt;int&gt;    &lt;dbl&gt;
##  1      1     24.2
##  2      2     19.2
##  3      3     19.3
##  4      4     19.4
##  5      5     19.0
##  6      6     19.0
##  7      7     18.8
##  8      8     19.0
##  9      9     19.1
## 10     10     19.5</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">auto_loocv <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(degree) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">test_mse =</span> <span class="kw">mean</span>(fold_mse)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> degree, <span class="dt">y =</span> test_mse)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>()</code></pre>
<p><img src="kuyper-stat302_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
</div>
<div id="k-fold-cross-validation" class="section level2">
<h2><span class="header-section-number">5.3</span> <span class="math inline">\(k\)</span>-fold Cross-Validation</h2>
<pre class="sourceCode r"><code class="sourceCode r">auto_10fold &lt;-<span class="st"> </span>auto_dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">crossv_kfold</span>(<span class="dv">10</span>, <span class="dt">id =</span> <span class="st">&quot;fold&quot;</span>)

auto_10fold &lt;-<span class="st"> </span>auto_10fold <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">crossing</span>(model_def) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model_fit =</span> <span class="kw">map2</span>(fmla, train, lm),
         <span class="dt">fold_mse =</span> <span class="kw">map2_dbl</span>(model_fit, test, mse))

auto_10fold <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> degree, <span class="dt">y =</span> fold_mse, <span class="dt">color =</span> fold)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_line</span>() </code></pre>
<p><img src="kuyper-stat302_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r">auto_10fold <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(degree) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">test_mse =</span> <span class="kw">mean</span>(fold_mse)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> degree, <span class="dt">y =</span> test_mse)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="kuyper-stat302_files/figure-html/unnamed-chunk-80-2.png" width="672" /></p>
</div>
<div id="the-bootstrap" class="section level2">
<h2><span class="header-section-number">5.4</span> The Bootstrap</h2>
<p>We will we using the <code>Portfolio</code> dataset from <code>ISLR</code> — see <code>?ISLR::Portfolio</code> for details. We will load the dataset from the <code>Portfolio.csv</code> file.</p>
<pre class="sourceCode r"><code class="sourceCode r">portfolio_dat &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/Portfolio.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">clean_names</span>()</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">portfolio_dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">skim</span>()</code></pre>
<pre><code>## Skim summary statistics
##  n obs: 100 
##  n variables: 2 
## 
## -- Variable type:numeric ---------------------------------------------------------------------------
##  variable missing complete   n   mean   sd    p0   p25   p50  p75 p100
##         x       0      100 100 -0.077 1.06 -2.43 -0.89 -0.27 0.56 2.46
##         y       0      100 100 -0.097 1.14 -2.73 -0.89 -0.23 0.81 2.57
##      hist
##  &lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2586&gt;&lt;U+2583&gt;&lt;U+2583&gt;&lt;U+2582&gt;
##  &lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2586&gt;&lt;U+2587&gt;&lt;U+2583&gt;&lt;U+2585&gt;&lt;U+2583&gt;&lt;U+2581&gt;</code></pre>
<div id="estimating-the-accuracy-of-a-statistic-of-interest" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Estimating the Accuracy of a Statistic of Interest</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Statistic of interest</span>
alpha_fn &lt;-<span class="st"> </span><span class="cf">function</span>(resample_obj){
  resample_obj <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="co"># turn resample object into dataset</span>
<span class="st">    </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">alpha =</span> (<span class="kw">var</span>(y)<span class="op">-</span><span class="kw">cov</span>(x,y))<span class="op">/</span>(<span class="kw">var</span>(x)<span class="op">+</span><span class="kw">var</span>(y)<span class="op">-</span><span class="dv">2</span><span class="op">*</span><span class="kw">cov</span>(x,y))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">pull</span>(alpha)
}

<span class="co"># Estimate on original data</span>
original_est &lt;-<span class="st"> </span>portfolio_dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">alpha_fn</span>()

original_est</code></pre>
<pre><code>## [1] 0.5758321</code></pre>
<!-- 
modelr must be specified in Rmarkdown for some reason
-->
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create 1000 bootstrap estimates</span>
portfolio_boot &lt;-<span class="st"> </span>portfolio_dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bootstrap</span>(<span class="dv">1000</span>, <span class="dt">id =</span> <span class="st">&quot;boot_id&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">alpha_boot =</span> <span class="kw">map_dbl</span>(strap, alpha_fn)) </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Summary of bootstrap estimates</span>
portfolio_boot <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(alpha_boot) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">skim</span>()</code></pre>
<pre><code>## Skim summary statistics
##  n obs: 1000 
##  n variables: 1 
## 
## -- Variable type:numeric ---------------------------------------------------------------------------
##    variable missing complete    n mean    sd   p0  p25  p50  p75 p100
##  alpha_boot       0     1000 1000 0.58 0.092 0.29 0.51 0.58 0.64 0.87
##      hist
##  &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2585&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2585&gt;&lt;U+2581&gt;&lt;U+2581&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Boxplot of bootstrap estimates with estimate from original data (red X)</span>
portfolio_boot <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">&quot;alpha_boot&quot;</span> , <span class="dt">y =</span> alpha_boot)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">&quot;alpha_boot&quot;</span>, <span class="dt">y =</span> original_est), 
               <span class="dt">shape =</span> <span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_flip</span>() </code></pre>
<p><img src="kuyper-stat302_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Histogram of bootstrap estimates with estimate from original data (red dashed line)</span>
portfolio_boot <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> alpha_boot)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">25</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> original_est),
               <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</code></pre>
<p><img src="kuyper-stat302_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Bootstrap estimate of standard error for estimator </span>
portfolio_boot <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">est_boot =</span> <span class="kw">mean</span>(alpha_boot),
            <span class="dt">est_se   =</span> <span class="kw">sd</span>(alpha_boot))</code></pre>
<pre><code>## # A tibble: 1 x 2
##   est_boot est_se
##      &lt;dbl&gt;  &lt;dbl&gt;
## 1    0.578 0.0921</code></pre>
</div>
<div id="estimating-the-accuracy-of-a-linear-regression-model" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Estimating the Accuracy of a Linear Regression Model</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1000 Bootstraps, fit models, get parameter estimates</span>
auto_boot &lt;-<span class="st"> </span>auto_dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bootstrap</span>(<span class="dv">1000</span>, <span class="dt">id =</span> <span class="st">&quot;boot_id&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model_fit =</span> <span class="kw">map</span>(strap, lm, <span class="dt">formula =</span> mpg <span class="op">~</span><span class="st"> </span>horsepower),
         <span class="dt">mod_tidy  =</span> <span class="kw">map</span>(model_fit, broom<span class="op">::</span>tidy))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Examine bootstrap coefficient estimates</span>
auto_boot <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(mod_tidy) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(term) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(term, estimate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">skim</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kable</span>()</code></pre>
<pre><code>## Skim summary statistics  
##  n obs: 2000    
##  n variables: 2    
## 
## Variable type: numeric
## 
##     term        variable    missing    complete     n      mean       sd       p0       p25      p50      p75     p100       hist   
## -------------  ----------  ---------  ----------  ------  -------  --------  -------  -------  -------  -------  -------  ----------
##  (Intercept)    estimate       0         1000      1000    39.95     0.89     37.47    39.38    39.98    40.5     42.91    &lt;U+2581&gt;&lt;U+2582&gt;&lt;U+2586&gt;&lt;U+2587&gt;&lt;U+2587&gt;&lt;U+2583&gt;&lt;U+2581&gt;&lt;U+2581&gt; 
##  horsepower     estimate       0         1000      1000    -0.16    0.0077    -0.18    -0.16    -0.16    -0.15    -0.14    &lt;U+2581&gt;&lt;U+2581&gt;&lt;U+2583&gt;&lt;U+2586&gt;&lt;U+2587&gt;&lt;U+2586&gt;&lt;U+2582&gt;&lt;U+2581&gt;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Histogram of bootstrap coefficient estimates</span>
auto_boot <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(mod_tidy) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> estimate)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(. <span class="op">~</span><span class="st"> </span>term, <span class="dt">scale =</span> <span class="st">&quot;free_x&quot;</span>)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="kuyper-stat302_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Boxplot of bootstrap coefficient estimates</span>
auto_boot <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(mod_tidy) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> estimate)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(. <span class="op">~</span><span class="st"> </span>term, <span class="dt">scale =</span> <span class="st">&quot;free_x&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_flip</span>()</code></pre>
<p><img src="kuyper-stat302_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Estimates using original data (including SE)</span>
auto_dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>horsepower, <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>broom<span class="op">::</span><span class="kw">tidy</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>statistic, <span class="op">-</span>p.value)</code></pre>
<pre><code>## # A tibble: 2 x 3
##   term        estimate std.error
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)   39.9     0.717  
## 2 horsepower    -0.158   0.00645</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Estimates using bootstrap </span>
auto_boot <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(mod_tidy) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(term) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">boot_est =</span> <span class="kw">mean</span>(estimate),
            <span class="dt">est_se   =</span> <span class="kw">sd</span>(estimate))</code></pre>
<pre><code>## # A tibble: 2 x 3
##   term        boot_est  est_se
##   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)   40.0   0.888  
## 2 horsepower    -0.158 0.00770</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lab-logistic-regression-lda-qda-and-knn.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="glossary-of-terms.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": "2"
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["kuyper-stat302.pdf", "kuyper-stat302.epub"],
"toc": {
"collapse": "section"
},
"highlight": "tango"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
